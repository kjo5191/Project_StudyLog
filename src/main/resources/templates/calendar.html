<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>ì¼ì • ìº˜ë¦°ë”</title>
	<link href="/css/styles.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />

	<style>
		/* ì˜¤ëŠ˜ ë‚ ì§œ ìƒ‰ìƒ */
		.fc .fc-day-today {
			background-color: #f1f3f5 !important; /* Bootstrapì˜ gray-100 ëŠë‚Œ */
		}

		/* ìš”ì¼ í—¤ë” í…ìŠ¤íŠ¸ */
		.fc .fc-col-header-cell-cushion {
			color: #343a40;
			font-weight: 500;
		}

		/* ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½ */
		.fc .fc-button-primary {
			background-color: #343a40;
			border-color: #343a40;
		}
		.fc .fc-button-primary:hover {
			background-color: #212529;
			border-color: #212529;
		}

		/* íˆ´ë°” í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
		.fc .fc-toolbar-title {
			color: #212529;
		}

		/* ì¼ì • í•­ëª© hover íš¨ê³¼ */
		.fc-event:hover {
			background-color: #212529 !important;
			cursor: pointer;
		}

		/* ë‚ ì§œ ìˆ«ì ìƒ‰ìƒ ë³€ê²½ (ê¸°ë³¸ì ìœ¼ë¡œ a íƒœê·¸ë¡œ ë˜ì–´ ìˆìŒ) */
		.fc .fc-daygrid-day-number {
			color: #212529 !important;
			text-decoration: none;
		}

		/* ì¼ì • í…ìŠ¤íŠ¸ ìƒ‰ìƒ (event title) */
		.fc .fc-event-title {
			color: #ffffff !important;
			font-weight: 500;
		}

		/* ì¼ì • ë°°ê²½ ìƒ‰ìƒ */
		.fc .fc-event {
			background-color: #343a40 !important;
			border: none !important;
		}

		/* hover ì‹œ ì¼ì • ê°•ì¡° */
		.fc-event:hover {
			background-color: #212529 !important;
			cursor: pointer;
		}


	</style>
</head>

<body>
	<!-- ìƒë‹¨ ë°” -->
	<div th:replace="fragments/navbar :: navbar"></div>

	<!-- <div class="container mt-5" style="max-width: 1000px;"> -->
	<div class="container mt-5">
		<h3 class="mb-4 text-center fw-semibold">Calendar</h3>
		<div id="calendar"></div>
	</div>

	<!-- <div class="container mt-4">
		<h3 class="mb-4 text-center">ğŸ“… ë‚´ ì¼ì • ë³´ê¸°</h3>
		<div id="calendar"></div>
	</div> -->

	<!-- ì¼ì • ë“±ë¡ ëª¨ë‹¬ -->
	<div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="text-dark" id="scheduleModalLabel">ì¼ì • ë“±ë¡</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="scheduleForm">
						<div class="mb-3">
							<label for="title" class="form-label">ì œëª©</label>
							<input type="text" class="form-control" id="title" required />
						</div>
						<div class="mb-3">
							<label for="content" class="form-label">ë‚´ìš©</label>
							<textarea class="form-control" id="content" rows="3"></textarea>
						</div>
						<div class="mb-3">
							<label for="startDate" class="form-label">ì‹œì‘ì¼ì‹œ</label>
							<input type="datetime-local" class="form-control" id="startDate" required />
						</div>
						<div class="mb-3">
							<label for="endDate" class="form-label">ì¢…ë£Œì¼ì‹œ (ì„ íƒ)</label>
							<input type="datetime-local" class="form-control" id="endDate" />
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
					<button type="button" class="btn btn-dark" onclick="submitSchedule()">ë“±ë¡</button>
				</div>
			</div>
		</div>
	</div>

	<!-- ì¼ì • ìƒì„¸ ëª¨ë‹¬ -->
	<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<input type="hidden" id="detailId" />
				<div class="modal-header">
					<h5 class="text-dark" id="detailModalLabel">ì¼ì • ìƒì„¸</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p><strong>ì œëª©:</strong> <span id="detailTitle"></span></p>
					<p><strong>ë‚´ìš©:</strong> <span id="detailContent"></span></p>
					<p><strong>ì‹œì‘ì¼:</strong> <span id="detailStart"></span></p>
					<p><strong>ì¢…ë£Œì¼:</strong> <span id="detailEnd"></span></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
					<button type="button" class="btn btn-dark" onclick="openEditModal()">ìˆ˜ì •</button>
					<button type="button" class="btn btn-dark" onclick="deleteSchedule()">ì‚­ì œ</button>
				</div>
			</div>
		</div>
	</div>

	<!-- ìˆ˜ì • ëª¨ë‹¬ -->
	<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<input type="hidden" id="editId" />
				<div class="modal-header">
					<h5 class="text-dark" id="editModalLabel">ì¼ì • ìˆ˜ì •</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="mb-3">
						<label for="editTitle" class="form-label">ì œëª©</label>
						<input type="text" class="form-control" id="editTitle" />
					</div>
					<div class="mb-3">
						<label for="editContent" class="form-label">ë‚´ìš©</label>
						<textarea class="form-control" id="editContent" rows="3"></textarea>
					</div>
					<div class="mb-3">
						<label for="editStart" class="form-label">ì‹œì‘ì¼ì‹œ</label>
						<input type="datetime-local" class="form-control" id="editStart" />
					</div>
					<div class="mb-3">
						<label for="editEnd" class="form-label">ì¢…ë£Œì¼ì‹œ</label>
						<input type="datetime-local" class="form-control" id="editEnd" />
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
					<button type="button" class="btn btn-outline-dark" onclick="submitEdit()">ì €ì¥</button>
				</div>
			</div>
		</div>
	</div>

	<!-- í•˜ë‹¨ ë°” -->
	<div th:replace="fragments/footer :: footer"></div>	

	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	document.addEventListener('DOMContentLoaded', function () {
		const calendarEl = document.getElementById('calendar');
		const calendar = new FullCalendar.Calendar(calendarEl, {
			initialView: 'dayGridMonth',
			themeSystem: 'bootstrap5',
			locale: 'ko',
			events: '/api/schedule',
			dateClick: function (info) {
				document.getElementById('startDate').value = info.dateStr + 'T09:00';
				document.getElementById('endDate').value = "";
				document.getElementById('scheduleModalLabel').textContent = formatDateLabel(info.dateStr);
				new bootstrap.Modal(document.getElementById('scheduleModal')).show();
			},
			// ì¼ì • í´ë¦­ ì‹œ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
			eventClick: function(info) {
				const event = info.event;

				document.getElementById('detailId').value = event.id;
				document.getElementById('detailTitle').textContent = event.title;
				document.getElementById('detailContent').textContent = event.extendedProps.content || '-';

				const start = event.start;
				const end = event.end;

				// í‘œì‹œìš© ë¬¸ìì—´ (ì˜ˆ: 2025. 5. 27. ì˜¤ì „ 09:00)
				const formatDateTime = (date) => {
					return date ? date.toLocaleString('ko-KR', {
						year: 'numeric',
						month: 'long',
						day: 'numeric',
						hour: '2-digit',
						minute: '2-digit',
						hour12: true
					}) : '-';
				};

				// hidden dataset ìš©ìœ¼ë¡œ ISO string ì €ì¥ (ìˆ˜ì • ì‹œ ì‚¬ìš©)
				document.getElementById('detailStart').textContent = formatDateTime(start);
				document.getElementById('detailStart').dataset.value = start ? start.toISOString() : '';

				document.getElementById('detailEnd').textContent = formatDateTime(end);
				document.getElementById('detailEnd').dataset.value = end ? end.toISOString() : '';

				const modal = new bootstrap.Modal(document.getElementById('detailModal'));
				modal.show();
			}
		});
		calendar.render();
	});

	function formatDateLabel(dateStr) {
		const date = new Date(dateStr);
		return `${date.getMonth() + 1}ì›” ${date.getDate()}ì¼ ì¼ì • ë“±ë¡`;
	}

	function formatDateInput(isoString) {
		if (!isoString || isoString === "-") return "";

		const date = new Date(isoString);
		const offset = date.getTimezoneOffset(); // ë¶„ ë‹¨ìœ„
		const localDate = new Date(date.getTime() - offset * 60 * 1000);

		return localDate.toISOString().slice(0, 16); // YYYY-MM-DDTHH:mm
	}

	function submitSchedule() {
		const title = document.getElementById('title').value;
		const content = document.getElementById('content').value;
		const start = document.getElementById('startDate').value;
		const end = document.getElementById('endDate').value;
		const data = { title, content, start, end: end || start, done: false };
		fetch("/api/schedule", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(data)
		}).then(res => {
			if (res.ok) {
				alert("ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
				location.reload();
			} else alert("ë“±ë¡ ì‹¤íŒ¨!");
		});
	}

	// ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
	function openEditModal() {
		document.getElementById('editId').value = document.getElementById('detailId').value;
		document.getElementById('editTitle').value = document.getElementById('detailTitle').textContent;
		document.getElementById('editContent').value = document.getElementById('detailContent').textContent;

		const startIso = document.getElementById('detailStart').dataset.value;
		const endIso = document.getElementById('detailEnd').dataset.value;

		document.getElementById('editStart').value = formatDateInput(startIso);
		document.getElementById('editEnd').value = formatDateInput(endIso);

		const modal = new bootstrap.Modal(document.getElementById('editModal'));
		modal.show();
	}

	function submitEdit() {
		const id = document.getElementById('editId').value;
		const title = document.getElementById('editTitle').value;
		const content = document.getElementById('editContent').value;
		const startInput = document.getElementById('editStart').value;
		const endInput = document.getElementById('editEnd').value;
		const start = startInput || document.getElementById('detailStart').textContent;
		const end = endInput || document.getElementById('detailEnd').textContent;
		const data = { id, title, content, start, end: end || start, done: false };
		fetch("/api/schedule/" + id, {
			method: "PUT",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(data)
		}).then(res => {
			if (res.ok) {
				alert("ìˆ˜ì • ì™„ë£Œ!");
				location.reload();
			} else alert("ìˆ˜ì • ì‹¤íŒ¨!");
		});
	}

	function deleteSchedule() {
		const id = document.getElementById('detailId').value;

		if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

		fetch("/api/schedule/" + id, {
			method: "DELETE"
		}).then(res => {
			if (res.ok) {
				alert("ì‚­ì œ ì™„ë£Œ!");
				location.reload();
			} else {
				alert("ì‚­ì œ ì‹¤íŒ¨!");
			}
		});
	}

	var calendar = new FullCalendar.Calendar(calendarEl, {
		initialView: 'dayGridMonth',
		themeSystem: 'bootstrap5',
		locale: 'ko',
		events: '/api/schedule',

		// âœ… ìƒ‰ìƒ ì¡°ì •
		eventColor: '#343a40',      // ì¼ì • ë°°ê²½ìƒ‰ (ë¶€íŠ¸ìŠ¤íŠ¸ë© gray-800)
		eventTextColor: '#ffffff',  // ì¼ì • í…ìŠ¤íŠ¸ (í°ìƒ‰)
		dayMaxEventRows: true
	});

</script>
</body>
</html>
